<html>
    <head>
        <title>開発者ツール開いてね</title>
    </head>
    <body>
        <div id="container">
            <center>だから開発者ツール開いてね！！<br></center>
            <label for="csvupload" style="outline:auto; padding:3px; outline-width: 3px; border-radius: 0;">週程表を読み込む</label>
            <input type="file" id="csvupload" accept=".csv" style="opacity:0;">
            <button onclick="javascript:OutputCSV">保存</button>
        </div>
        
    
    <script>
        var upload = document.getElementById("csvupload");
        upload.addEventListener("change", get_csv)
        function get_csv() {
            if (upload.files.length == 0) {
                console.log("No file selected");
                return;
            }
            else if (upload.files.length > 1) {
                console.log("Uploaded too many files");
                return;
            }

            // 配列を定義
            let csv = "";
            let csvArray = [];
            var csvReadError = "";
            

            // CSVファイルへのパス
            const file = upload.files[0];
            const reader = new FileReader();
            reader.onload = () => {
                let csv = reader.result;
                console.log(reader.result);

                    // 改行ごとに配列化
                    let lines = csv.split("\n");
                if (lines.length < 7) {
                    csvReadError = "wrongformat";
                }
                else {
                        // 1行ごとに処理
                        for (let i = 0; i < lines.length; ++i) {
                            let cells = lines[i].split(",");
                            for (let i=0 ;i < 6;i++) {
                                if (typeof cells[i] == "undefined") {
                                    cells[i] = "";
                                }
                            }
                            cells[5] = cells[5].replace("\r","");
                            csvArray.push(cells);
                        }
                        if (csvArray[0][0] != "校時/曜日") {
                            csvReadError = "unavailabledata";
                        }
                        // コンソールに配列を出力
                        console.log(csvArray);

                    }
                    
                    if (csvReadError != "") {
                        console.log("エラーが発生しました:" + csvReadError);
                    } else {
                        let userdata = {};
                        userdata["schedule"] = {}
                        for (let d=0; d<5; d++) {
                            for (let t=0; t<6; t++) {
                                if (csvArray[t+1][d+1] != "") {
                                    userdata["schedule"][d + "-" + t] = csvArray[t+1][d+1];
                                }
                            }
                        }
                        console.log(userdata);
                    }
                }
            reader.readAsText(file);
        }
    </script>

</body>
</html>